<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitorización</title>
    <style>
        /* Estilos CSS para la interfaz */
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #007f00;
        }
        /* ... otros estilos para los elementos de la interfaz ... */
    </style>
</head>
<body>
    <div class="container">
        <h1>Monitorización</h1>
        <div>
            <label for="huerto">Huerto:</label>
            <select id="huerto">
                <option value="huerto1">Huerto 1</option>
            </select>
        </div>
        <div>
            <label for="fecha">Fecha:</label>
            <select id="fecha">
                <option value="tiempo-real">Tiempo Real</option>
                <option value="1-dia">Último día</option>
                <option value="7-dias">Últimos 7 días</option>
                <option value="30-dias">Últimos 30 días</option>
                <option value="rango">Rango de fechas</option>
            </select>
            <div id="rangoFechas" style="display: none;">
                <label for="fechaInicio">Desde:</label>
                <input type="date" id="fechaInicio">
                <label for="fechaFin">Hasta:</label>
                <input type="date" id="fechaFin">
            </div>
        </div>
        <div>
            <label for="sensor">Sensor:</label>
            <select id="sensor">
                <option value="sensor1">Sensor 1</option>
            </select>
        </div>
        <table id="tablaDatos">
            <thead>
                <tr>
                    <th>Fecha y Hora</th>
                    <th>Humedad (%)</th>
                    <th>Salinidad (ppm)</th>
                    <th>Temperatura (°C)</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <canvas id="graficoDatos"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const datosSensores = [
            { fecha: "2024-05-10T08:00:00", humedad: 65, salinidad: 800, temperatura: 25 },
            { fecha: "2024-05-10T09:00:00", humedad: 70, salinidad: 820, temperatura: 26 },
            { fecha: "2024-05-10T10:00:00", humedad: 68, salinidad: 810, temperatura: 27 },
        ];

        function mostrarDatos(datos) {
            const tablaBody = document.querySelector("#tablaDatos tbody");
            tablaBody.innerHTML = "";
            datos.forEach(sensor => {
                const fila = document.createElement("tr");
                fila.innerHTML = `
                    <td>${sensor.fecha}</td>
                    <td>${sensor.humedad}</td>
                    <td>${sensor.salinidad}</td>
                    <td>${sensor.temperatura}</td>
                `;
                tablaBody.appendChild(fila);
            });
        }

        function mostrarGrafico(datos) {
            const fechas = datos.map(sensor => sensor.fecha);
            const humedades = datos.map(sensor => sensor.humedad);
            const salinidades = datos.map(sensor => sensor.salinidad);
            const temperaturas = datos.map(sensor => sensor.temperatura);

            const graficoDatos = document.getElementById("graficoDatos").getContext("2d");
            new Chart(graficoDatos, {
                type: 'line',
                data: {
                    labels: fechas,
                    datasets: [{
                        label: 'Humedad (%)',
                        data: humedades,
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    }, {
                        label: 'Salinidad (ppm)',
                        data: salinidades,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    }, {
                        label: 'Temperatura (°C)',
                        data: temperaturas,
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    }
                }
            });
        }

        function obtenerDatos() {
            const huertoSeleccionado = document.getElementById("huerto").value;
            const fechaSeleccionada = document.getElementById("fecha").value;
            const sensorSeleccionado = document.getElementById("sensor").value;

            let datosFiltrados = datosSensores.filter(sensor => sensor.humedad !== undefined && sensor.salinidad !== undefined && sensor.temperatura !== undefined);
            switch (fechaSeleccionada) {
                case "1-dia":
                    datosFiltrados = datosFiltrados.filter(sensor => new Date(sensor.fecha) > new Date() - 24 * 60 * 60 * 1000);
                    break;
                case "7-dias":
                    datosFiltrados = datosFiltrados.filter(sensor => new Date(sensor.fecha) > new Date() - 7 * 24 * 60 * 60 * 1000);
                    break;
                case "30-dias":
                    datosFiltrados = datosFiltrados.filter(sensor => new Date(sensor.fecha) > new Date() - 30 * 24 * 60 * 60 * 1000);
                    break;
                case "rango":
                    const fechaInicio = new Date(document.getElementById("fechaInicio").value);
                    const fechaFin = new Date(document.getElementById("fechaFin").value);
                    datosFiltrados = datosFiltrados.filter(sensor => new Date(sensor.fecha) >= fechaInicio && new Date(sensor.fecha) <= fechaFin);
                    break;
                default:
                    break;
            }
            mostrarDatos(datosFiltrados);
            mostrarGrafico(datosFiltrados);
        }

        document.getElementById("huerto").addEventListener("change", obtenerDatos);
        document.getElementById("fecha").addEventListener("change", function() {
            document.getElementById("rangoFechas").style.display = this.value === "rango" ? "block" : "none";
            obtenerDatos();
        });
        document.getElementById("fechaInicio").addEventListener("change", obtenerDatos);
        document.getElementById("fechaFin").addEventListener("change", obtenerDatos);
        document.getElementById("sensor").addEventListener("change", obtenerDatos);

        obtenerDatos(); // Mostrar datos por defecto al cargar la página
    </script>
</body>
</html>
